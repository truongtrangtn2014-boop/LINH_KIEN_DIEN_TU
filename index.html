<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>·ª®NG D·ª§NG AI NH·∫¨N DI·ªÜN LINH KI·ªÜN ƒêI·ªÜN T·ª¨</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8"></script>
  <script src="data.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background: #007bff;
      color: white;
      padding: 10px 0;
      font-size: 20px;
      font-weight: bold;
    }
    .container {
      margin: 15px auto;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
    }
    #webcam-container canvas {
      border-radius: 12px;
      border: 2px solid #007bff;
      width: 100%;
      height: auto;
    }
    input {
      margin: 5px;
      padding: 8px;
      width: 80%;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      margin: 8px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .info {
      text-align: left;
      margin-top: 15px;
    }
    .quiz {
      margin-top: 15px;
      text-align: left;
    }
  </style>
</head>
<body>

  <header>
    ·ª®NG D·ª§NG AI NH·∫¨N DI·ªÜN LINH KI·ªÜN ƒêI·ªÜN T·ª¨ <br>
    <small>Tr∆∞·ªùng THPT Tr·∫ßn Qu·ªëc Tu·∫•n</small>
  </header>

  <div class="container">
    <h3>Nh·∫≠p th√¥ng tin h·ªçc sinh</h3>
    <input type="text" id="studentName" placeholder="H·ªç v√† t√™n">
    <input type="text" id="studentClass" placeholder="L·ªõp">

    <div id="webcam-container"></div>

    <div>
      <button onclick="init()">üì∑ B·∫≠t camera</button>
      <button onclick="stopCamera()">‚èπ D·ª´ng</button>
      <button onclick="switchCamera()">üîÑ Chuy·ªÉn camera</button>
    </div>

    <div class="info">
      <p><strong>T√™n linh ki·ªán:</strong> <span id="ten"></span></p>
      <p><strong>C√¥ng d·ª•ng:</strong> <span id="congdung"></span></p>
      <p><strong>Nguy√™n l√Ω ho·∫°t ƒë·ªông:</strong> <span id="nguyenly"></span></p>
    </div>

    <div id="quiz-section" class="quiz"></div>
  </div>

  <footer style="margin: 20px; font-size: 13px; color: gray;">
    ¬© 2025 Tr∆∞·ªùng THPT Tr·∫ßn Qu·ªëc Tu·∫•n ‚Äî ·ª®ng d·ª•ng AI trong d·∫°y h·ªçc C√¥ng ngh·ªá
  </footer>

  <script>
    const URL = "./my_model/";
    let model, webcam, maxPredictions;
    let currentDevice = "";
    let flip = true;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      webcam = new tmImage.Webcam(300, 300, flip);
      await webcam.setup();
      await webcam.play();
      document.getElementById("webcam-container").innerHTML = "";
      document.getElementById("webcam-container").appendChild(webcam.canvas);
      window.requestAnimationFrame(loop);
    }

    async function loop() {
      webcam.update();
      await predict();
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      prediction.sort((a, b) => b.probability - a.probability);
      const result = prediction[0];

      if (result.probability > 0.85) {
        const linhKien = result.className;
        document.getElementById("ten").innerText = linhKien;

        if (device_data[linhKien]) {
          document.getElementById("congdung").innerText = device_data[linhKien].cong_dung;
          document.getElementById("nguyenly").innerText = device_data[linhKien].nguyen_ly;

          if (currentDevice !== linhKien) {
            currentDevice = linhKien;
            showQuiz(device_data[linhKien].quiz);
          }
        }
      }
    }

    function stopCamera() {
      if (webcam) webcam.stop();
    }

    function switchCamera() {
      flip = !flip;
      stopCamera();
      init();
    }

    function showQuiz(questions) {
      const quizSection = document.getElementById("quiz-section");
      quizSection.innerHTML = "<h3>C√¢u h·ªèi tr·∫Øc nghi·ªám</h3>";

      questions.forEach((q, index) => {
        let qHTML = `<p><strong>${index + 1}. ${q.question}</strong></p>`;
        q.options.forEach(opt => {
          qHTML += `<label><input type='radio' name='q${index}' value='${opt}'> ${opt}</label><br>`;
        });
        quizSection.innerHTML += qHTML;
      });

      quizSection.innerHTML += "<button onclick='submitQuiz()'>üì© G·ª≠i k·∫øt qu·∫£</button>";
    }

    function submitQuiz() {
      const name = document.getElementById("studentName").value.trim();
      const lop = document.getElementById("studentClass").value.trim();

      if (!name || !lop) {
        alert("Vui l√≤ng nh·∫≠p h·ªç t√™n v√† l·ªõp.");
        return;
      }

      const answers = document.querySelectorAll("input[type='radio']:checked");
      let selected = [];
      answers.forEach(a => selected.push(a.value));

      alert("C·∫£m ∆°n " + name + " (" + lop + ") ƒë√£ ho√†n th√†nh tr·∫Øc nghi·ªám!");

      // G·ª≠i d·ªØ li·ªáu l√™n Google Sheet (n·∫øu c√≥)
      // fetch('https://script.google.com/macros/s/XXXX/exec', {
      //   method: 'POST',
      //   body: JSON.stringify({ name, lop, device: currentDevice, answers: selected })
      // });
    }
  </script>
</body>
</html>
